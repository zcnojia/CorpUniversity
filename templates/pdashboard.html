{% load static %}
<!doctype html>
<html lang="en">

<head>
    <title>Permanent Dashboard</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

    <h1>Add Course</h1>
    <form id="addCourseForm">
        <label for="courseName">Course Name:</label>
        <input type="text" id="courseName" name="courseName" required>
        <br>
        <label for="courseCode">Course Code:</label>
        <input type="text" id="courseCode" name="courseCode" required>
        <br>
          <select name="qualification">
            {% for qualification in data.qualifications %}
            <option value="{{ qualification.Id }}">{{ qualification.Name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Create Course</button>
    </form>

<input type="hidden" id="hiddenValue" value="{{ data.username }}">

<table>
        <thead>
            <tr>
                <th>Code</th>
                <th>Name</th>
                <th>Instructor Id</th>
            </tr>
        </thead>
        <tbody>
            {% for course in data.courses %}
            <tr>
                <td>{{ course.code }}</td>
                <td>{{ course.Name }}</td>
                <td>{{ course.permanent_staff_id }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2">No courses found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

 <table>
        <thead>
            <tr>
                <th>Course Name</th>
                <th>Course Code</th>
                <th>Instructor</th>
            </tr>
        </thead>
        <tbody>
            {% for course in data.myCourses %}
            <tr>
                <td>{{ course.Name }}</td>
                <td>{{ course.code }}</td>
                <td>{{ data.username }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2">No courses found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>



<script>


            $(document).ready(function() {
            $('#addCourseForm').submit(function(event) {
                event.preventDefault(); // Prevent form submission

                var form = document.getElementById('addCourseForm');
                var formData = new FormData(form);

                var hiddenValue = document.getElementById('hiddenValue').value;

                formData.append('username', hiddenValue);
                  for (var pair of formData.entries()) {
    console.log(pair[0] + ': ' + pair[1]);
  }

                $.ajax({
                    url: '/add_course',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        // Handle the success response
                        console.log("sucess")
                    },
                    error: function(xhr, status, error) {
                        // Handle the error response
                    }
                });

            });
        });


        // Assuming you have the JWT token available in the 'token' variable
        var token = '{{ data }}';

        // Define the cookie name and expiration time (optional)
        var cookieName = 'jwtToken';
        var expirationDays = 7; // Set the desired number of days

        // Calculate the expiration date
        var expirationDate = new Date();
        expirationDate.setDate(expirationDate.getDate() + expirationDays);

        // Create the cookie string
        var cookieValue = encodeURIComponent(token) + '; expires=' + expirationDate.toUTCString() + '; path=/';

        // Set the cookie
        document.cookie = cookieName + '=' + cookieValue;

        // Display a success message (optional)
        console.log('JWT token saved in cookie successfully.');
    </script>


</html>